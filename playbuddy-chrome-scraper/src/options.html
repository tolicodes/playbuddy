<!DOCTYPE html>
<html>
  <head>
    <title>Playbuddy FetLife Scraper</title>
    <style>
      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        padding: 20px;
        width: 800px; /* 800 is near Chromeâ€™s popup max */
        max-width: 800px; /* wider */
        background: radial-gradient(circle at 20% 20%, rgba(96,165,250,0.07), transparent 35%),
                    radial-gradient(circle at 80% 10%, rgba(16,185,129,0.07), transparent 30%),
                    #0b1220;
        color: #e5e7eb;
      }

      h1 {
        font-size: 1.75em;
        margin-bottom: 12px;
        letter-spacing: -0.02em;
      }

      #log {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid var(--border);
        background: #0c1626;
        color: #e5e7eb;
        height: 200px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-family: "SFMono-Regular", Consolas, monospace;
        font-size: 13px;
      }

      input,
      button {
        margin-top: 10px;
        padding: 10px 12px;
        font-size: 1em;
        border-radius: 10px;
        border: 1px solid #1f2a3d;
        background: linear-gradient(120deg, #3b82f6, #22c55e);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: filter 0.2s ease;
      }
      button:hover { filter: brightness(1.05); }

      input[type="text"] {
        width: 100%;
        box-sizing: border-box;
      }

      #apiStatus {
        margin-left: 10px;
        font-size: 0.9em;
        color: #666;
      }

      #tableOutput a {
        color: #fff;
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h1>Scraper</h1>

    <!-- API Key -->
    <label for="apiKey">API Key</label>
    <input id="apiKey" type="text" placeholder="Enter your API key" />
    <button id="saveApiKey">Save</button>
    <span id="apiStatus"></span>
    <div style="margin-top:10px; max-width:320px;">
      <label for="apiEnv">API Environment</label>
      <select id="apiEnv" style="width:100%; padding:10px 12px; border-radius:10px; border:1px solid #1f2a3d; background:#0c1626; color:#e5e7eb;">
        <option value="local">Local (http://localhost:8080)</option>
        <option value="prod">Production (https://api.playbuddy.me)</option>
      </select>
    </div>

    <div style="margin-top:12px;">
      <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
        <input id="testMode" type="checkbox" style="width:16px; height:16px; accent-color:#22c55e;" />
        <span>Test mode (limits runs and shortens delays)</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px; cursor:pointer; margin-top:6px;">
        <input id="skipOverwrite" type="checkbox" style="width:16px; height:16px; accent-color:#22c55e;" />
        <span>Do not overwrite existing events</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px; cursor:pointer; margin-top:6px;">
        <input id="autoFetlife" type="checkbox" style="width:16px; height:16px; accent-color:#22c55e;" />
        <span>Auto-run Fetlife every 12h</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px; cursor:pointer; margin-top:6px;">
        <input id="autoFetlifeNearby" type="checkbox" style="width:16px; height:16px; accent-color:#22c55e;" />
        <span>Auto-run Fetlife Nearby (API) every 12h</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px; cursor:pointer; margin-top:6px;">
        <span style="white-space:nowrap;">Max events to scrape</span>
        <input id="maxEvents" type="number" min="1" step="1" placeholder="1000" style="width:120px; color:#0b1220; background:#e5e7eb; border-radius:6px; padding:6px 8px; border:1px solid #1f2a3d;" />
      </label>
    </div>

    <!-- Actions -->
    <div style="margin-top: 18px;">
      <button id="startFetlife">Start Fetlife</button>
      <button id="startFetlifeNearby">Start Fetlife Nearby</button>
      <button id="startFetlifeNearbyApi">Start Fetlife Nearby (API)</button>
      <button id="startFetlifeFestivals">Start Fetlife Festivals</button>
      <button id="startFetlifeFriendsStage1">Stage 1: Fetlife Friends (Counts)</button>
      <button id="startInstagram">Start Instagram</button>
      <button id="startTicketTailor">Start TicketTailor</button>
      <button id="startPluraPromoStats">Start Plura Promo Stats</button>

      <div style="margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <input id="stage2File" type="file" accept="application/json" style="background:#0c1626; color:#e5e7eb; border-radius:6px; padding:6px; border:1px solid #1f2937;" />
        <button id="startFetlifeFriendsStage2">Stage 2: Scrape Uploaded Handles</button>
      </div>

      <div style="margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <input id="singleFetlifeHandle" type="text" placeholder="Enter one Fetlife handle (e.g. Queens_Kinksters)" style="background:#0c1626; color:#e5e7eb; border-radius:6px; padding:10px 12px; border:1px solid #1f2937; flex:1; min-width:260px;" />
        <button id="startSingleFetlifeHandle">Scrape Single Handle</button>
      </div>
    </div>

    <div id="log"></div>

    <h2 style="margin-top:24px;">Latest Upload Preview</h2>
    <div id="tableOutput" style="margin-top:8px; border:1px solid #ccc; padding:10px; background:#0f172a20; overflow:auto; color:#e5e7eb;"></div>

    <h2 style="margin-top:24px;">Run History</h2>
    <div id="runLogs" style="margin-top:8px; border:1px solid #ccc; padding:10px; background:#0f172a20;"></div>

    <script type="module" src="./options.js"></script>
  </body>
</html>
